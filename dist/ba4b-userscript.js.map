{"version":3,"sources":["/ba4b-userscript.coffee","/view/image_replacer.coffee","/config.js","/util/downloader.coffee","events"],"names":["config","Downloader","ImageChanger","libs","main","jQuery","require","$","downloader","imageChanger","cacheMap","map","ImageReplacer","images","format","str","name","path","module","exports","EventEmitter","url","console","GM_xmlhttpRequest","e","response","JSON","process","isArray","Array","xs","Object","prototype","toString","call","defaultMaxListeners","setMaxListeners","n","_events","maxListeners","emit","type","error","length","arguments","Error","handler","args","slice","apply","listeners","i","l","addListener","listener","warned","m","undefined","trace","push","on","once","self","g","removeListener","list","indexOf","splice","removeAllListeners"],"mappings":"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","sourceRoot":"..\\src","sourcesContent":["libs = \r\n  $ : jQuery\r\n\r\nDownloader = require \"util/downloader.coffee\"\r\nconfig = require \"config.js\"\r\nImageChanger = require \"view/image_replacer.coffee\"\r\n\r\n\r\nmain = ($)->\r\n  downloader = new Downloader\r\n  imageChanger = new ImageChanger $\r\n  cacheMap = {}\r\n  downloader.responseType = \"json\"\r\n  \r\n  downloader.on \"success\", (map)->\r\n    imageChanger.change map\r\n    cacheMap = map\r\n    return true\r\n  downloader.download config.path\r\n  \r\n\r\nmain(libs.$)","class ImageReplacer\r\n  constructor: (jQuery)->\r\n    @$ = jQuery\r\n  \r\n  change: (map)->\r\n    images = @$ \"img\"\r\n    format = /http:\\/\\/avatar2.bahamut.com.tw\\/avataruserpic\\/\\w\\/\\w\\/(\\w+)\\/.*/g\r\n    images = images.filter ()->\r\n      str = this.src\r\n      return format.test str\r\n    images.each ->\r\n      name = format.exec this.src\r\n      name = name[1]\r\n      if name and map[name]\r\n        this.src = map[name]\r\n      return true","var config = {\r\n    path : \"\"\r\n}\r\n\r\nmodule.exports = config;","{EventEmitter} = require 'events'\r\n\r\nclass Downloader extends EventEmitter\r\n  constructor: ()->\r\n    @_cachedURL = []\r\n    @_cache = {}\r\n    @locked = false\r\n    @responseType = \"\"\r\n  download: (url)->\r\n    if @locked\r\n      console.log 'incorrect invoke'\r\n      return false\r\n    \r\n    if url in @_cachedURL\r\n      @emit 'success', @_cache[url]\r\n      @removeAllListeners 'success'\r\n      return true\r\n    \r\n    @locked = true\r\n    \r\n    console.log 'download start'\r\n    \r\n    GM_xmlhttpRequest\r\n      url : url\r\n      onload : (e)=>\r\n        response = e.responseText\r\n        if @responseType is \"json\"\r\n          response = JSON.parse response\r\n        \r\n        if (!response)\r\n          @emit 'fail', url\r\n        \r\n        @emit 'success',response\r\n        return true\r\n      onerror : (e)=>\r\n        @emit 'fail', url\r\n        @locked = false\r\n        return true\r\n      method : \"GET\"\r\n      \r\n    return true\r\n\r\nmodule.exports = Downloader","if (!process.EventEmitter) process.EventEmitter = function () {};\n\nvar EventEmitter = exports.EventEmitter = process.EventEmitter;\nvar isArray = typeof Array.isArray === 'function'\n    ? Array.isArray\n    : function (xs) {\n        return Object.prototype.toString.call(xs) === '[object Array]'\n    }\n;\n\n// By default EventEmitters will print a warning if more than\n// 10 listeners are added to it. This is a useful default which\n// helps finding memory leaks.\n//\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nvar defaultMaxListeners = 10;\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!this._events) this._events = {};\n  this._events.maxListeners = n;\n};\n\n\nEventEmitter.prototype.emit = function(type) {\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events || !this._events.error ||\n        (isArray(this._events.error) && !this._events.error.length))\n    {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n      return false;\n    }\n  }\n\n  if (!this._events) return false;\n  var handler = this._events[type];\n  if (!handler) return false;\n\n  if (typeof handler == 'function') {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        var args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n    return true;\n\n  } else if (isArray(handler)) {\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    var listeners = handler.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n      listeners[i].apply(this, args);\n    }\n    return true;\n\n  } else {\n    return false;\n  }\n};\n\n// EventEmitter is defined in src/node_events.cc\n// EventEmitter.prototype.emit() is also defined there.\nEventEmitter.prototype.addListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('addListener only takes instances of Function');\n  }\n\n  if (!this._events) this._events = {};\n\n  // To avoid recursion in the case that type == \"newListeners\"! Before\n  // adding it to the listeners, first emit \"newListeners\".\n  this.emit('newListener', type, listener);\n\n  if (!this._events[type]) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  } else if (isArray(this._events[type])) {\n\n    // Check for listener leak\n    if (!this._events[type].warned) {\n      var m;\n      if (this._events.maxListeners !== undefined) {\n        m = this._events.maxListeners;\n      } else {\n        m = defaultMaxListeners;\n      }\n\n      if (m && m > 0 && this._events[type].length > m) {\n        this._events[type].warned = true;\n        console.error('(node) warning: possible EventEmitter memory ' +\n                      'leak detected. %d listeners added. ' +\n                      'Use emitter.setMaxListeners() to increase limit.',\n                      this._events[type].length);\n        console.trace();\n      }\n    }\n\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  } else {\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  var self = this;\n  self.on(type, function g() {\n    self.removeListener(type, g);\n    listener.apply(this, arguments);\n  });\n\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('removeListener only takes instances of Function');\n  }\n\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (!this._events || !this._events[type]) return this;\n\n  var list = this._events[type];\n\n  if (isArray(list)) {\n    var i = list.indexOf(listener);\n    if (i < 0) return this;\n    list.splice(i, 1);\n    if (list.length == 0)\n      delete this._events[type];\n  } else if (this._events[type] === listener) {\n    delete this._events[type];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (type && this._events && this._events[type]) this._events[type] = null;\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  if (!this._events) this._events = {};\n  if (!this._events[type]) this._events[type] = [];\n  if (!isArray(this._events[type])) {\n    this._events[type] = [this._events[type]];\n  }\n  return this._events[type];\n};\n"]}