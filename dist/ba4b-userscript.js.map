{"version":3,"sources":["/ba4b-userscript.coffee","/util/storage.coffee","/view/image_replacer.coffee","/config.js","/util/downloader.coffee","events"],"names":["defaultConfig","Downloader","ImageChanger","libs","main","Storage","jQuery","require","$","downloader","imageChanger","storage","GM_getValue","GM_setValue","config","Date","obj","window","GM_Storage","getMethod","setMethod","namespace","key","value","defaultValue","cache","JSON","module","ImageReplacer","list","images","result","format","str","name","path","expireTime","exports","EventEmitter","url","console","GM_xmlhttpRequest","e","response","process","isArray","Array","xs","Object","prototype","toString","call","defaultMaxListeners","setMaxListeners","n","_events","maxListeners","emit","type","error","length","arguments","Error","handler","args","slice","apply","listeners","i","l","addListener","listener","warned","m","undefined","trace","push","on","once","self","g","removeListener","indexOf","splice","removeAllListeners"],"mappings":"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","sourceRoot":"..\\src","sourcesContent":["libs = \r\n  $ : jQuery\r\n\r\nDownloader = require \"util/downloader.coffee\"\r\ndefaultConfig = require \"config.js\"\r\nImageChanger = require \"view/image_replacer.coffee\"\r\nStorage = require \"util/storage.coffee\"\r\n###\r\nlist format\r\n{\r\n  \"list\": \r\n    [\r\n      {\r\n        \"BAHA_ID\": \"pcchou\",\r\n        \"HASHED_MAIL\": \"7ab6825f7735466f759547d3c78902e6\"\r\n      },\r\n      {\r\n        \"BAHA_ID\": \"seadog007\",\r\n        \"HASHED_MAIL\": \"d41d8cd98f00b204e9800998ecf8427e\"\r\n      }\r\n    ]\r\n}\r\n###\r\n\r\nmain = ($)->\r\n  downloader = new Downloader\r\n  imageChanger = new ImageChanger $\r\n  downloader.responseType = \"json\"\r\n  storage = new Storage(GM_getValue, GM_setValue)\r\n  #console.log storage\r\n  #console.log storage.get 'expire'\r\n  #console.log storage.get 'list'\r\n  config = storage.get config, defaultConfig\r\n  \r\n  if (storage.get \"list\")? and (storage.get 'expire') > Date.now()\r\n    imageChanger.change storage.get(\"list\")\r\n  else\r\n    downloader.on \"success\", (obj)->\r\n      imageChanger.change obj.list\r\n      \r\n      storage.set 'expire', Date.now() + config.expireTime * 1000\r\n      storage.set 'list', obj.list\r\n      \r\n      return true\r\n    downloader.download config.path\r\n  return true\r\n\r\nif window is window.top\r\n  main libs.$\r\n","class GM_Storage\r\n  constructor: (getMethod, setMethod, namespace = 'ba4b')->\r\n    @_get = getMethod\r\n    @_set = setMethod\r\n    @namespace = namespace\r\n    @cache = null\r\n    @_load()\r\n\r\n  set: (key, value)->\r\n    #make sure always get newest value\r\n    @_load()\r\n    @cache[key] = value\r\n    @_save()\r\n\r\n  get: (key, defaultValue)->\r\n    #make sure always get newest value\r\n    @_load()\r\n    if @cache[key]\r\n      @cache[key]\r\n    else if defaultValue?\r\n      defaultValue\r\n    else\r\n      undefined\r\n\r\n  remove: (key)->\r\n    #make sure always get newest value\r\n    @_load()\r\n    delete cache[key]\r\n    @_save()\r\n\r\n  #use when storage was modified by another program\r\n  reload: ()->\r\n    @_load\r\n\r\n  _load: ()->\r\n    if GM_getValue(@namespace)\r\n      @cache = JSON.parse GM_getValue @namespace\r\n    else\r\n      @cache = {}\r\n      @_save\r\n\r\n  _save: ()->\r\n    GM_setValue @namespace, JSON.stringify @cache\r\n\r\nmodule.exports = GM_Storage","class ImageReplacer\r\n  constructor: (jQuery)->\r\n    @$ = jQuery\r\n  \r\n  change: (list)->\r\n    images = @$ \"img\"\r\n    result = false\r\n    format = /http:\\/\\/avatar2.bahamut.com.tw\\/avataruserpic\\/\\w\\/\\w\\/(\\w+)\\/.*/g\r\n    images = images.filter ()->\r\n      str = this.src\r\n      return format.test str\r\n    images.each ->\r\n      str = this.src\r\n      name = str.split(\"/\")\r\n      ###\r\n      \"I really have no idea why it didn't work\"\r\n      if not name\r\n        console.log str, \"exec fail?\"\r\n        return true\r\n      ###\r\n      name = name[6]\r\n      \r\n      for value in list\r\n        if value.BAHA_ID is name\r\n          if str.search(\"_s\") >= 0\r\n            this.src = \"http:\\/\\/www.gravatar.com\\/avatar\\/#{value.HASHED_MAIL}?s=40\"\r\n          else\r\n            this.src = \"http:\\/\\/www.gravatar.com\\/avatar\\/#{value.HASHED_MAIL}?s=110\"\r\n          result = true\r\n          return true\r\n          \r\n      return true\r\n    return true\r\n\r\n\r\nmodule.exports = ImageReplacer","var config = {\r\n    path : \"\",\r\n    expireTime : \"1800\" /*in second*/\r\n};\r\n\r\nmodule.exports = config;","{EventEmitter} = require 'events'\r\n\r\nclass Downloader extends EventEmitter\r\n  constructor: ()->\r\n    @locked = false\r\n    @responseType = \"\"\r\n  download: (url)->\r\n    if @locked\r\n      console.log 'incorrect invoke'\r\n      return false\r\n    \r\n    @locked = true\r\n    \r\n    console.log \"download start : #{url}\"\r\n    \r\n    GM_xmlhttpRequest\r\n      url : url\r\n      onload : (e)=>\r\n        response = e.responseText\r\n        \r\n        console.log \"download finish : #{url}\"\r\n        #console.log e.responseText\r\n        \r\n        if @responseType is \"json\"\r\n          response = JSON.parse response\r\n        \r\n        if (!response)\r\n          @emit 'fail', url\r\n          return true\r\n        \r\n        @emit 'success',response\r\n        return true\r\n      onerror : (e)=>\r\n        @emit 'fail', url\r\n        @locked = false\r\n        return true\r\n      method : \"GET\"\r\n      \r\n    return true\r\n\r\nmodule.exports = Downloader","if (!process.EventEmitter) process.EventEmitter = function () {};\n\nvar EventEmitter = exports.EventEmitter = process.EventEmitter;\nvar isArray = typeof Array.isArray === 'function'\n    ? Array.isArray\n    : function (xs) {\n        return Object.prototype.toString.call(xs) === '[object Array]'\n    }\n;\n\n// By default EventEmitters will print a warning if more than\n// 10 listeners are added to it. This is a useful default which\n// helps finding memory leaks.\n//\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nvar defaultMaxListeners = 10;\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!this._events) this._events = {};\n  this._events.maxListeners = n;\n};\n\n\nEventEmitter.prototype.emit = function(type) {\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events || !this._events.error ||\n        (isArray(this._events.error) && !this._events.error.length))\n    {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n      return false;\n    }\n  }\n\n  if (!this._events) return false;\n  var handler = this._events[type];\n  if (!handler) return false;\n\n  if (typeof handler == 'function') {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        var args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n    return true;\n\n  } else if (isArray(handler)) {\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    var listeners = handler.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n      listeners[i].apply(this, args);\n    }\n    return true;\n\n  } else {\n    return false;\n  }\n};\n\n// EventEmitter is defined in src/node_events.cc\n// EventEmitter.prototype.emit() is also defined there.\nEventEmitter.prototype.addListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('addListener only takes instances of Function');\n  }\n\n  if (!this._events) this._events = {};\n\n  // To avoid recursion in the case that type == \"newListeners\"! Before\n  // adding it to the listeners, first emit \"newListeners\".\n  this.emit('newListener', type, listener);\n\n  if (!this._events[type]) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  } else if (isArray(this._events[type])) {\n\n    // Check for listener leak\n    if (!this._events[type].warned) {\n      var m;\n      if (this._events.maxListeners !== undefined) {\n        m = this._events.maxListeners;\n      } else {\n        m = defaultMaxListeners;\n      }\n\n      if (m && m > 0 && this._events[type].length > m) {\n        this._events[type].warned = true;\n        console.error('(node) warning: possible EventEmitter memory ' +\n                      'leak detected. %d listeners added. ' +\n                      'Use emitter.setMaxListeners() to increase limit.',\n                      this._events[type].length);\n        console.trace();\n      }\n    }\n\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  } else {\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  var self = this;\n  self.on(type, function g() {\n    self.removeListener(type, g);\n    listener.apply(this, arguments);\n  });\n\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('removeListener only takes instances of Function');\n  }\n\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (!this._events || !this._events[type]) return this;\n\n  var list = this._events[type];\n\n  if (isArray(list)) {\n    var i = list.indexOf(listener);\n    if (i < 0) return this;\n    list.splice(i, 1);\n    if (list.length == 0)\n      delete this._events[type];\n  } else if (this._events[type] === listener) {\n    delete this._events[type];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (type && this._events && this._events[type]) this._events[type] = null;\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  if (!this._events) this._events = {};\n  if (!this._events[type]) this._events[type] = [];\n  if (!isArray(this._events[type])) {\n    this._events[type] = [this._events[type]];\n  }\n  return this._events[type];\n};\n"]}